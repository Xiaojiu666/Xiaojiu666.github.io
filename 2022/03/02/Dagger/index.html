<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta name="author" content="Gx">



    <meta name="description" content="description">



<title>Dagger2 | Nine`s Blog</title>



    <link rel="icon" href="/image/luancher.jpg">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    



    <!-- scripts list from _config.yml -->
    
    <script src="/js/script.js"></script>
    
    <script src="/js/tocbot.min.js"></script>
    



    
    
        
    


<meta name="generator" content="Hexo 6.0.0"></head>

<body>
    <script>
        // this function is used to check current theme before page loaded.
        (() => {
            const currentTheme = window.localStorage && window.localStorage.getItem('theme') || '';
            const isDark = currentTheme === 'dark';
            const pagebody = document.getElementsByTagName('body')[0]
            if (isDark) {
                pagebody.classList.add('dark-theme');
                // mobile
                document.getElementById("mobile-toggle-theme").innerText = "· Dark"
            } else {
                pagebody.classList.remove('dark-theme');
                // mobile
                document.getElementById("mobile-toggle-theme").innerText = "· Light"
            }
        })();
    </script>

    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo"><a href="/">Nine&#39;s Blog</a></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/archives">博客</a>
                
                    <a class="menu-item" href="/category">分类</a>
                
                    <a class="menu-item" href="/tag">标签</a>
                
                    <a class="menu-item" href="/about">关于</a>
                
                <input id="switch_default" type="checkbox" class="switch_default">
                <label for="switch_default" class="toggleBtn"></label>
            </div>
        </div>
    </nav>

    
    <nav class="navbar-mobile" id="nav-mobile">
        <div class="container">
            <div class="navbar-header">
                <div>
                    <a href="/">Nine&#39;s Blog</a><a id="mobile-toggle-theme">·&nbsp;Light</a>
                </div>
                <div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div>
            </div>
            <div class="menu" id="mobile-menu">
                
                    <a class="menu-item" href="/archives">博客</a>
                
                    <a class="menu-item" href="/category">分类</a>
                
                    <a class="menu-item" href="/tag">标签</a>
                
                    <a class="menu-item" href="/about">关于</a>
                
            </div>
        </div>
    </nav>

</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if(toggleMenu.classList.contains("active")){
           toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        }else{
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }
</script>
            <div class="main">
                <div class="container">
    
    
        <div class="post-toc">
    <div class="tocbot-list">
    </div>
    <div class="tocbot-list-menu">
        <a class="tocbot-toc-expand" onclick="expand_toc()">Expand all</a>
        <a onclick="go_top()">Back to top</a>
        <a onclick="go_bottom()">Go to bottom</a>
    </div>
</div>

<script>
    document.ready(
        function () {
            tocbot.init({
                tocSelector: '.tocbot-list',
                contentSelector: '.post-content',
                headingSelector: 'h1, h2, h3, h4, h5',
                collapseDepth: 1,
                orderedList: false,
                scrollSmooth: true,
            })
        }
    )

    function expand_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 6,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "collapse_toc()");
        b.innerHTML = "Collapse all"
    }

    function collapse_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 1,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "expand_toc()");
        b.innerHTML = "Expand all"
    }

    function go_top() {
        window.scrollTo(0, 0);
    }

    function go_bottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }

</script>
    

    
    <article class="post-wrap">
        <header class="post-header">
            <h1 class="post-title">Dagger2</h1>
            
                <div class="post-meta">
                    
                        Author: <a itemprop="author" rel="author" href="/">Gx</a>
                    

                    
                        <span class="post-time">
                        Date: <a href="#">March 2, 2022&nbsp;&nbsp;21:05:41</a>
                        </span>
                    
                    
                        <span class="post-category">
                    Category:
                            
                                <a href="/categories/JetPack/">JetPack</a>
                            
                        </span>
                    
                </div>
            
        </header>

        <div class="post-content">
            <h3 id="什么是Dagger2"><a href="#什么是Dagger2" class="headerlink" title="什么是Dagger2"></a>什么是Dagger2</h3><p>  Dagger2是根据依赖注入衍生出的一套<code>静态解决方案，可生成在编译时连接依赖项的代码</code>。 在我看来Dagger2是一个又高级又低级的的框架，在Java开发中，对象无处不在，无论是从初级开发，还是高级架构师，都离不开<code>Objec object =new Objec();</code>,每个java程序员每天都需要new 很多对象，为什么简简单单的new对象，却要Dagger2搞得如此复杂呢？通过源码, 我们一起看下原理~</p>
<h6 id="官方介绍"><a href="#官方介绍" class="headerlink" title="官方介绍"></a>官方介绍</h6><p>Dagger 可以执行以下操作，使您无需再编写冗长乏味又容易出错的样板代码：</p>
<ul>
<li>生成您在手动 DI 部分手动实现的 AppContainer 代码（应用图）。</li>
<li>为应用图中提供的类创建 factory。这就是在内部满足依赖关系的方式。</li>
<li>重复使用依赖项或创建类型的新实例，具体取决于您如何使用作用域配置该类型。</li>
<li>为特定流程创建容器，操作方法与上一部分中使用 Dagger 子组件为登录流程创建容器的方法相同。这样可以释放内存中不再需要的对象，从而提升应用性能。</li>
</ul>
<p>只要您声明类的依赖项并指定如何使用注释满足它们的依赖关系，Dagger 便会在构建时自动执行以上所有操作。Dagger 生成的代码与您手动编写的代码类似。在内部，Dagger 会创建一个对象图，然后它可以参考该图来找到提供类实例的方式。对于图中的每个类，Dagger 都会生成一个 factory 类型类，它会使用该类在内部获取该类型的实例。</p>
<h3 id="Dagger2-基础使用"><a href="#Dagger2-基础使用" class="headerlink" title="Dagger2-基础使用"></a>Dagger2-基础使用</h3><h6 id="基础依赖"><a href="#基础依赖" class="headerlink" title="基础依赖"></a>基础依赖</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">implementation <span class="string">&#x27;com.google.dagger:dagger:2.x&#x27;</span></span><br><span class="line">annotationProcessor <span class="string">&#x27;com.google.dagger:dagger-compiler:2.x&#x27;</span></span><br></pre></td></tr></table></figure>

<h6 id="注解-Inject"><a href="#注解-Inject" class="headerlink" title="注解-@Inject"></a>注解-@Inject</h6><p>  自动生成提供当前实例的工厂类 主要注释在两个地方(构造函数和全局变量)</p>
<p><img src="/image/Dagger2-@inject-%E6%9E%84%E9%80%A0.png"></p>
<ul>
<li>空构造函数:</li>
</ul>
<p>  被注解的类，Dagger会自动帮我们实例化对象，也就是 帮助我们做了<code>new Computer()</code>的动作，那让我们试一下，被<code>@Inject</code>注释的类会发生什么变化。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//CPU类，@Inject 后，Rebuid一下项目</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CPU</span> &#123;</span><br><span class="line">    fun <span class="title function_">getCpuName</span><span class="params">()</span> = <span class="string">&quot;I9-10900X&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面讲过 ，Dagger2会在编译期生成代码，Rebuid一下项目，我们就会看到Dagger帮我们生成的代码，让我们查看一下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//省略..</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">CPU_Factory</span> <span class="keyword">implements</span> <span class="title class_">Factory</span>&lt;CPU&gt; &#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> CPU <span class="title function_">get</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> newInstance();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> CPU_Factory <span class="title function_">create</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> InstanceHolder.INSTANCE;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> CPU <span class="title function_">newInstance</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CPU</span>();</span><br><span class="line">  &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">CPU_Factory</span> <span class="variable">INSTANCE</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CPU_Factory</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>分析下生成的<code>CPU_Factory</code>类 首先不可修改 实现Factory接口，重写get()方法，主要就是做了两件事：</p>
<ul>
<li><p>重写get方法，返回我们@Inject 构造的对象，其实就是帮我们<code>new 了一个 Person()</code>。</p>
</li>
<li><p>生成一个<code>CPU_Factory</code>的单例(注意，是Phone_Factory，而不是Person单例)。</p>
<p>那我们是不是可以通过<code>CPU_Factory.create().get</code> 就能拿到CPU的实例了呢，确实可以，但这样做完全没意义，直接new 不香么，没人会傻到这么做，我们记下来继续看下带参构造。</p>
<ul>
<li>带参构造:</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Computer</span> <span class="meta">@Inject</span> constructor(<span class="keyword">var</span> cpu: CPU) &#123;</span><br><span class="line">    <span class="type">var</span> <span class="variable">phoneName</span> <span class="operator">=</span> <span class="string">&quot;Mac&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Rebuild一下项目</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">Computer_Factory</span> <span class="keyword">implements</span> <span class="title class_">Factory</span>&lt;Computer&gt; &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> Provider&lt;CPU&gt; cpuProvider;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">Computer_Factory</span><span class="params">(Provider&lt;CPU&gt; cpuProvider)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.cpuProvider = cpuProvider;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> Computer <span class="title function_">get</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> newInstance(cpuProvider.get());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> Computer_Factory <span class="title function_">create</span><span class="params">(Provider&lt;CPU&gt; cpuProvider)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Computer_Factory</span>(cpuProvider);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> Computer <span class="title function_">newInstance</span><span class="params">(CPU cpu)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Computer</span>(cpu);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>对比无参构造发现，你会发现一个区别：</p>
<ul>
<li>1、空参的Factory类是单例，而带参的Factory会需要一个Provider&lt;参数&gt; 作为入参</li>
<li>2、Computer newInstance() 的时候需要一个参数，而这个参数，则是通过CPU_Factory.get()获取到的，其实这时候就关联起来了，这样我们就通过2、Computer_Factory.get()方法拿到了一个带着CPU对象的Computer引用。</li>
</ul>
<p>但这还是不够，因为没人会这样用，简直就是多此一举，接下来我们配合其他注解，继续完善代码。</p>
<ul>
<li>成员变量:</li>
</ul>
<p>在开发的过程中，并不是所有类都有构造，例如Android中，常见的Activity，全部是通过系统源码创建，那我们如何像Activity中注入所需要的对象呢，Dagger 为我们提供了一种方法，将@Inject 注解在成员变量上，通过容器类，将依赖方与需求方进行绑定。</p>
<p>我们依旧将CPU注入给Computer</p>
<p>1、声明容器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//@Component下面会说到用法</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">ComputerComponent</span> &#123;</span><br><span class="line">    fun <span class="title function_">inject</span><span class="params">(computer: Computer)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2、调用并注入</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Computer</span> &#123;</span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    lateinit <span class="keyword">var</span> cpu: CPU</span><br><span class="line"></span><br><span class="line">    init &#123;</span><br><span class="line">        DaggerComputerComponent.create().inject(<span class="built_in">this</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>rebuild项目生成代码</p>
<p>容器接口暂时省略..<br>下面讲到在细说</p>
<p>根据依赖需求方 Person 中 被@Inject修饰的变量 生成此类</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">Computer_MembersInjector</span> <span class="keyword">implements</span> <span class="title class_">MembersInjector</span>&lt;Computer&gt; &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> Provider&lt;CPU&gt; cpuProvider;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> Provider&lt;Disk&gt; diskProvider;</span><br><span class="line">  <span class="comment">// 1</span></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">Computer_MembersInjector</span><span class="params">(Provider&lt;CPU&gt; cpuProvider, Provider&lt;Disk&gt; diskProvider)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.cpuProvider = cpuProvider;</span><br><span class="line">    <span class="built_in">this</span>.diskProvider = diskProvider;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> MembersInjector&lt;Computer&gt; <span class="title function_">create</span><span class="params">(Provider&lt;CPU&gt; cpuProvider,</span></span><br><span class="line"><span class="params">      Provider&lt;Disk&gt; diskProvider)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Computer_MembersInjector</span>(cpuProvider, diskProvider);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//2</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">injectMembers</span><span class="params">(Computer instance)</span> &#123;</span><br><span class="line">    injectCpu(instance, cpuProvider.get());</span><br><span class="line">    injectDisk(instance, diskProvider.get());</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//3</span></span><br><span class="line">  <span class="meta">@InjectedFieldSignature(&quot;com.gx.task.di.demo.Computer.cpu&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">injectCpu</span><span class="params">(Computer instance, CPU cpu)</span> &#123;</span><br><span class="line">    instance.cpu = cpu;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@InjectedFieldSignature(&quot;com.gx.task.di.demo.Computer.disk&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">injectDisk</span><span class="params">(Computer instance, Disk disk)</span> &#123;</span><br><span class="line">    instance.disk = disk;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>  我们继续分析源码<br>  来看被我们注释的成员变量:<br>    - 1、Dagger检测到 Person类中有变量存在@Inject注释，自动根据Computer(需求方的名字)+_MembersInjector 实现 MembersInjector生成一个类。<br>    - 2、构造根据被@Inject 注释变量的个数 传入多个<code>Provider&lt;T&gt;</code>。<br>    - 3、重写接口中<code>injectMembers()</code>方法，但暂时没用到<br>    - 4、核心关键<code>injectCpu()</code>方法，将需求方和依赖方进行绑定。</p>
<p>最后我们总结一下@Inject注释：</p>
<ul>
<li>注解在构造:1、被注解的类，自动实现<code>Provider&lt;T&gt;</code>接口生成工厂类，通过实现接口中<code>get()</code>方法，主要用于提供注解类的对象。2、如果被注解的构造有参数，则会通过参数的<code>Provider&lt;T&gt;</code>的<code>get()</code>方法，注入到需求方。</li>
<li>注解在变量:2、被注解变量所在的类，自动实现<code>MembersInjector&lt;T&gt;</code>接口生成帮助类，通过实现接口中的<code>injectMembers()</code>方法，进行赋值绑定。</li>
</ul>
<h6 id="注解-Component"><a href="#注解-Component" class="headerlink" title="注解-@Component"></a>注解-@Component</h6><p>  我们上面说过，整个依赖注入里面可以包括三个模块，被注入方，依赖提供方，容器。上面我们已经通过@Injected注释，讲了被注入方和提供方，接下来我们看看被@Component注释的接口。上面在注解成员变量的时候，我们有用过@Component注释的接口。让我们继续看下源码。<br><img src="/image/Dagger2-@inject-%E6%88%90%E5%91%98%E5%8F%98%E9%87%8F.png"></p>
<p>  @Component相对来说比较简单，只能用在接口上</p>
<ul>
<li>简单对外提供实例</li>
</ul>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">ComputerComponent</span> &#123;</span><br><span class="line">    fun <span class="title function_">inject</span><span class="params">(computer: Computer)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>  依旧是Build一下项目</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1 调用DaggerComputerComponent.create().inject(this)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">DaggerComputerComponent</span> <span class="keyword">implements</span> <span class="title class_">ComputerComponent</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="title function_">DaggerComputerComponent</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> Builder <span class="title function_">builder</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Builder</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> ComputerComponent <span class="title function_">create</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Builder</span>().build();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">inject</span><span class="params">(Computer computer)</span> &#123;</span><br><span class="line">    injectComputer(computer);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> Computer <span class="title function_">injectComputer</span><span class="params">(Computer instance)</span> &#123;</span><br><span class="line">    Computer_MembersInjector.injectCpu(instance, <span class="keyword">new</span> <span class="title class_">CPU</span>());</span><br><span class="line">    Computer_MembersInjector.injectDisk(instance, <span class="keyword">new</span> <span class="title class_">Disk</span>());</span><br><span class="line">    <span class="keyword">return</span> instance;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">Builder</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Builder</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> ComputerComponent <span class="title function_">build</span><span class="params">()</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DaggerComputerComponent</span>();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>分析下容器代码:</p>
<ul>
<li>1、被@Component 注释的接口 会自动以<code>Dagger+接口名</code>生成实现类,</li>
<li>2、通过一个Builder模式提供当容器类的实例(为什么用Builder模式后面会讲到)</li>
<li>3、重写接口方法，根据传入的需求方，进行赋值绑定。</li>
</ul>
<p>简单总结一下@Component 注释:</p>
<ul>
<li>只能用于接口上，会根据接口自动生成容器类，通过Builder绑定。</li>
<li>会重写接口里面的方法，将需求方传入，与提供方进行赋值绑定。</li>
</ul>
<p>在简单的使用过程中，有几个疑问</p>
<ul>
<li>被@Inject修饰构造，所生产的Factory，其实并没有应用到</li>
<li>为什么被@Component修饰的接口所生成的类 会通过Builder模式提供实例？</li>
</ul>
<h3 id="Dagger2-模块"><a href="#Dagger2-模块" class="headerlink" title="Dagger2-模块"></a>Dagger2-模块</h3><p>在使用模块的时候，我们先考虑一个问题，我们上面的所讲的Demo中 <code>依赖提供方</code>都是可以<br>通过new去实例化的类，但是在实际开发过程中，我们有很多实例，是无法直接 new 出来的，例如，现在有一台电脑，只能有一块主板，一块CPU，所以主板和CPU均是通过单例提供，这个时候容器类，就无法帮我们new出来我们想要的实例，那主板如何给Computer提供依赖呢？这个时候就需要我们手动提供给容器接口，由他来进行绑定。</p>
<p>Dagger2给我们提供了两个新的注释 @Module 和 @Provides 配合@Component使用<br><img src="/image/Dagger2-@module.png"></p>
<h6 id="模块基础使用"><a href="#模块基础使用" class="headerlink" title="模块基础使用"></a>模块基础使用</h6><p>假设我们现在有一台电脑，需要两个配件，一个主板，一个CPU，但在整个电脑里，主板和CPU 都只能有一个。这时候我们就需要像电脑里注入一块CPU 一块主板</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//模块</span></span><br><span class="line"><span class="meta">@Module</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PartsModule</span>() &#123;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">  <span class="meta">@Provides</span></span><br><span class="line">  fun <span class="title function_">provideCPU</span><span class="params">()</span>: CPU &#123;</span><br><span class="line">      <span class="keyword">return</span> CPU.create()!!</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Provides</span></span><br><span class="line">  fun <span class="title function_">provideBroad</span><span class="params">()</span>: MainBoard &#123;</span><br><span class="line">      <span class="keyword">return</span> MainBoard.create()!!</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//容器</span></span><br><span class="line"><span class="meta">@Component(modules = [PartsModule::class])</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">ComputerComponent</span> &#123;</span><br><span class="line">    fun <span class="title function_">inject</span><span class="params">(computer: Computer)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Computer</span>() &#123;</span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    lateinit <span class="keyword">var</span> cpu: CPU</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    lateinit <span class="keyword">var</span> mainBoard: MainBoard</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">   lateinit <span class="keyword">var</span> disk: Disk</span><br><span class="line"></span><br><span class="line">    init &#123;</span><br><span class="line">      <span class="comment">// 调用</span></span><br><span class="line">       DaggerComputerComponent.builder()</span><br><span class="line">       .computerModule(PartsModule()).build().inject(<span class="built_in">this</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们来看一下容器的源码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">DaggerComputerComponent</span> <span class="keyword">implements</span> <span class="title class_">ComputerComponent</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> PartsModule partsModule;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="title function_">DaggerComputerComponent</span><span class="params">(PartsModule partsModuleParam)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.partsModule = partsModuleParam;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> Builder <span class="title function_">builder</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Builder</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> ComputerComponent <span class="title function_">create</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Builder</span>().build();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">inject</span><span class="params">(Computer computer)</span> &#123;</span><br><span class="line">    injectComputer(computer);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> Computer <span class="title function_">injectComputer</span><span class="params">(Computer instance)</span> &#123;</span><br><span class="line">    Computer_MembersInjector.injectCpu(instance, PartsModule_ProvideCPUFactory.provideCPU(partsModule));</span><br><span class="line">    Computer_MembersInjector.injectDisk(instance, <span class="keyword">new</span> <span class="title class_">Disk</span>());</span><br><span class="line">    Computer_MembersInjector.injectMainBoard(instance, PartsModule_ProvideMainBoardFactory.provideMainBoard(partsModule));</span><br><span class="line">    <span class="keyword">return</span> instance;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">Builder</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> PartsModule partsModule;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Builder</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Builder <span class="title function_">partsModule</span><span class="params">(PartsModule partsModule)</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.partsModule = Preconditions.checkNotNull(partsModule);</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> ComputerComponent <span class="title function_">build</span><span class="params">()</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (partsModule == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="built_in">this</span>.partsModule = <span class="keyword">new</span> <span class="title class_">PartsModule</span>();</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DaggerComputerComponent</span>(partsModule);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>大致流程和之前的容器代码一样</p>
<ul>
<li>1、被@Component 注释的接口 会自动以Dagger+接口名生成实现类,</li>
<li>2、通过一个Builder模式提供当容器类的实例(为什么用Builder模式后面会讲到)</li>
<li>3、重写接口方法，根据传入的需求方，进行赋值绑定。</li>
</ul>
<p>差异化的是</p>
<ul>
<li>1、通过builder 注入 @Component 中的modules</li>
<li>2、绑定时，可以直接new的类，直接 new ，不能 new的类， 通过module中提供的方法获取。</li>
</ul>
<p>我们来看一下被module修饰的类会帮我们做哪些事情<br>被@module中@Provides修饰的方法，和最开始提及的被@Inject修饰的构造一样，均会实现Factory接口，重写get方法，用于提供实例。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">PartsModule_ProvideMainBoardFactory</span> <span class="keyword">implements</span> <span class="title class_">Factory</span>&lt;MainBoard&gt; &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> PartsModule <span class="keyword">module</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">PartsModule_ProvideMainBoardFactory</span><span class="params">(PartsModule <span class="keyword">module</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.<span class="keyword">module</span> = <span class="keyword">module</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> MainBoard <span class="title function_">get</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> provideMainBoard(<span class="keyword">module</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> PartsModule_ProvideMainBoardFactory <span class="title function_">create</span><span class="params">(PartsModule <span class="keyword">module</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PartsModule_ProvideMainBoardFactory</span>(<span class="keyword">module</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> MainBoard <span class="title function_">provideMainBoard</span><span class="params">(PartsModule instance)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Preconditions.checkNotNullFromProvides(instance.provideMainBoard());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>总结:</p>
<ul>
<li>1、@module+@Provides 和 @Injcet在构造上的作用一样，均是为了提供实例，前者通过module类中的方法，获取实例。</li>
<li>2、容器中的builder模式，就是为了应对多个module时，用于产生容器对象，协助绑定需求方。</li>
</ul>
<h4 id="模块传递参数"><a href="#模块传递参数" class="headerlink" title="模块传递参数"></a>模块传递参数</h4><p>假设我们电脑中的部件，主板和显卡都需要供电，那我们在module中需要电的引用， 一般有几种方法 1、通过module的构造传入 2、使用@Provides提供实例。 我们围绕第二种来试一下，修改上面的代码。</p>
<p>一块需要供电的主板。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MainBoard</span> <span class="keyword">private</span> <span class="title function_">constructor</span><span class="params">(<span class="keyword">var</span> electric: Electric)</span> &#123;</span><br><span class="line">    companion object &#123;</span><br><span class="line">        fun <span class="title function_">create</span><span class="params">(electric: Electric)</span>: MainBoard? &#123;</span><br><span class="line">            <span class="keyword">return</span> InstanceHolder(electric).INSTANCE</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">class</span> <span class="title class_">InstanceHolder</span>(electric: Electric) &#123;</span><br><span class="line">            <span class="type">val</span> <span class="variable">INSTANCE</span> <span class="operator">=</span> MainBoard(electric)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>module类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Module</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PartsModule</span>() &#123;</span><br><span class="line">    <span class="meta">@Provides</span></span><br><span class="line">    fun <span class="title function_">provideElectric</span><span class="params">()</span> = Electric()</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Provides</span></span><br><span class="line">    fun <span class="title function_">provideMainBoard</span><span class="params">(electric: Electric)</span>: MainBoard &#123;</span><br><span class="line">        <span class="keyword">return</span> MainBoard.create(electric)!!</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>provideElectric()</code>方法也是被@Provides修饰，所以会生成一个工厂类，用来提供Electric的实例。<br>接下里开下容器类，依旧是<code>inject()</code>方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">//省略....</span></span><br><span class="line"> <span class="keyword">private</span> Computer <span class="title function_">injectComputer</span><span class="params">(Computer instance)</span> &#123;</span><br><span class="line">     Computer_MembersInjector.injectCpu(instance, PartsModule_ProvideCPUFactory.provideCPU(partsModule));</span><br><span class="line">     Computer_MembersInjector.injectDisk(instance, <span class="keyword">new</span> <span class="title class_">Disk</span>());</span><br><span class="line">     Computer_MembersInjector.injectMainBoard(instance, mainBoard());</span><br><span class="line">     <span class="comment">// Computer_MembersInjector.injectMainBoard(instance, PartsModule_ProvideMainBoardFactory.provideMainBoard(partsModule));</span></span><br><span class="line">     <span class="keyword">return</span> instance;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">private</span> MainBoard <span class="title function_">mainBoard</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> PartsModule_ProvideMainBoardFactory.provideMainBoard(partsModule, PartsModule_ProvideElectricFactory.provideElectric(partsModule));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看出，在进行绑定的时候，injectMainBoard()方法里面，MainBoard实例获取的方式不一样了，但其根本依旧是通过<code>PartsModule_ProvideMainBoardFactory.provideElectric()</code>获取到，只是多了一个参数<code>PartsModule_ProvideElectricFactory.provideElectric(partsModule)</code>,其实这个参数就是MainBorad所需的Electric实例。<br>至此，传递参数，我们也已经很清晰了。</p>
<h3 id="Dagger2-范围（单例）"><a href="#Dagger2-范围（单例）" class="headerlink" title="Dagger2-范围（单例）"></a>Dagger2-范围（单例）</h3><p>我们上面提到过的主板和CPU等部件，都是整个对象单例，但实际情况并不是所有电脑都用一个CPU，而是每一台电脑使用一个CPU，这个时候我们就需要优化我们的代码，使我们的单例仅针对这一台Computer，也就是模块的范围。</p>
<h5 id="Singleton"><a href="#Singleton" class="headerlink" title="@Singleton"></a>@Singleton</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1 module</span></span><br><span class="line"><span class="meta">@Singleton</span></span><br><span class="line"><span class="meta">@Provides</span></span><br><span class="line">fun <span class="title function_">provideCPU</span><span class="params">()</span>: CPU &#123;</span><br><span class="line">    <span class="keyword">return</span> CPU()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//2 提供方</span></span><br><span class="line"><span class="meta">@Singleton</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CPU</span> <span class="meta">@Inject</span> constructor()  &#123;</span><br><span class="line">  fun <span class="title function_">getCpuName</span><span class="params">()</span> = <span class="string">&quot;I9-10900X&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//3 容器</span></span><br><span class="line"><span class="meta">@Singleton</span></span><br><span class="line"><span class="meta">@Component(modules = [PartsModule::class])</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">ComputerComponent</span> &#123;</span><br><span class="line">    fun <span class="title function_">inject</span><span class="params">(computer: Computer)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们在外面new两个Computer的实例，看下日志</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Computer</span>(<span class="keyword">var</span> context: Context) &#123;</span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    lateinit <span class="keyword">var</span> cpu: CPU</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    lateinit <span class="keyword">var</span> cpu1: CPU</span><br><span class="line"></span><br><span class="line">    init &#123;</span><br><span class="line">        DaggerComputerComponent.builder().partsModule(PartsModule()).build().inject(<span class="built_in">this</span>)</span><br><span class="line">        Log.e(<span class="string">&quot;Computer cpu&quot;</span> ,cpu.toString())</span><br><span class="line">        Log.e(<span class="string">&quot;Computer cpu1&quot;</span> ,cpu1.toString())</span><br><span class="line">        <span class="comment">// 第一个</span></span><br><span class="line">        <span class="comment">//cpu: [BaseActivity.kt, onCreate, 42]:com.gx.task.di.computer.CPU@ad51322</span></span><br><span class="line">        <span class="comment">//cpu1: [BaseActivity.kt, onCreate, 42]:com.gx.task.di.computer.CPU@ad51322</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//第二次输出</span></span><br><span class="line">        <span class="comment">//[BaseActivity.kt, onCreate, 43]:com.gx.task.di.computer.CPU@6d9b1b3</span></span><br><span class="line">        <span class="comment">//[BaseActivity.kt, onCreate, 43]:com.gx.task.di.computer.CPU@6d9b1b3</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>那Dagger是如何做到的，其实玄机就在容器类里面，我们只需要关注一下绑定时，<code>依赖提供方</code>的实例如何获取的，就知道Dagger是如何做到在module中单例。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1</span></span><br><span class="line"><span class="keyword">private</span> Computer <span class="title function_">injectComputer</span><span class="params">(Computer instance)</span> &#123;</span><br><span class="line">  Computer_MembersInjector.injectCpu(instance, provideCPUProvider.get());</span><br><span class="line">  Computer_MembersInjector.injectCpu1(instance, provideCPUProvider.get());</span><br><span class="line">  <span class="keyword">return</span> instance;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//2</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">initialize</span><span class="params">(<span class="keyword">final</span> PartsModule partsModuleParam)</span> &#123;</span><br><span class="line">  <span class="built_in">this</span>.provideCPUProvider = DoubleCheck.provider(PartsModule_ProvideCPUFactory.create(partsModuleParam));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//3 DoubleCheck.class</span></span><br><span class="line"><span class="comment">//核心单例</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> T <span class="title function_">get</span><span class="params">()</span> &#123;</span><br><span class="line">   <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> instance;</span><br><span class="line">   <span class="keyword">if</span> (result == UNINITIALIZED) &#123;</span><br><span class="line">     <span class="keyword">synchronized</span> (<span class="built_in">this</span>) &#123;</span><br><span class="line">       result = instance;</span><br><span class="line">       <span class="keyword">if</span> (result == UNINITIALIZED) &#123;</span><br><span class="line">         result = provider.get();</span><br><span class="line">         instance = reentrantCheck(instance, result);</span><br><span class="line">         <span class="comment">/* Null out the reference to the provider. We are never going to need it again, so we</span></span><br><span class="line"><span class="comment">          * can make it eligible for GC. */</span></span><br><span class="line">         provider = <span class="literal">null</span>;</span><br><span class="line">       &#125;</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> (T) result;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>分析:</p>
<ul>
<li>1、在容器中绑定时，两个变量，都是通过provideCPUProvider.get()获取实例</li>
<li>2、provideCPUProvider  根据 DoubleCheck.provider()代理所得，将PartsModule_ProvideCPUFactory实例转为DoubleCheck的实例,因为他们俩均实现了Provider接口</li>
<li>3、最终provideCPUProvider已经被转换为DoubleCheck 所以调用的DoubleCheck重的get()方法，这里通过双重检查单例，返回CPU对象，这样就保证了容器中，所有的CPU都是同一个实例，所以注入到需求方，赋值绑定时，get()拿到的都是同一个实例。</li>
</ul>
<h3 id="Dagger2进阶-子组件"><a href="#Dagger2进阶-子组件" class="headerlink" title="Dagger2进阶-子组件"></a>Dagger2进阶-子组件</h3><h5 id="子组件继承"><a href="#子组件继承" class="headerlink" title="子组件继承"></a>子组件继承</h5><p>在实际项目中，为了方便管理，我们通常会将各个容器进行统一管理，这样有一个好处，父容器所提供的实例，子容器也可以用，并且子容器的生命周期是可控的。</p>
<p>上面我们只是讲了一台电脑，假如我们项目中 除了电脑 还有一部手机，这样的话，无论电脑还是手机都需要供电，那我们就需要把provideElectric()放在最顶层，<br>那我们就需要两个容器分别来提供 不同的实例<br><img src="/image/Dagger2-%E5%AD%90%E5%AE%B9%E5%99%A8.png"><br>通过上面看出，在AppComponent中，通过AppMoudle 提供<code>Electric</code>实例，提供一个接口返回一个<code>Electric</code>实例。</p>
<p>使用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Inject</span></span><br><span class="line">lateinit <span class="keyword">var</span> cpu: CPU</span><br><span class="line"><span class="meta">@Inject</span></span><br><span class="line">lateinit <span class="keyword">var</span> electric: Electric</span><br><span class="line"><span class="meta">@Inject</span></span><br><span class="line">lateinit <span class="keyword">var</span> otherPart: OtherPart</span><br><span class="line"><span class="meta">@Inject</span></span><br><span class="line">lateinit <span class="keyword">var</span> mainBoard: MainBoard</span><br><span class="line"></span><br><span class="line"><span class="comment">// 先构建App的容器</span></span><br><span class="line"><span class="type">val</span> <span class="variable">appComponent</span> <span class="operator">=</span> DaggerAppComponent.builder().appModule(AppModule()).build()</span><br><span class="line"><span class="comment">//由于 dependencies 关系，会在Buidler中 提供方法，注入appComponent</span></span><br><span class="line">DaggerComputerComponent.builder().appComponent(appComponent).partsModule(PartsModule())</span><br></pre></td></tr></table></figure>

<p>分析：DaggerAppComponent.class</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">DaggerAppComponent</span> <span class="keyword">implements</span> <span class="title class_">AppComponent</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> AppModule appModule;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="title function_">DaggerAppComponent</span><span class="params">(AppModule appModuleParam)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.appModule = appModuleParam;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> Builder <span class="title function_">builder</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Builder</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> AppComponent <span class="title function_">create</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Builder</span>().build();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> Electric <span class="title function_">provideElectric</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> AppModule_ProvideElectricFactory.provideElectric(appModule);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">Builder</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> AppModule appModule;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Builder</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Builder <span class="title function_">appModule</span><span class="params">(AppModule appModule)</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.appModule = Preconditions.checkNotNull(appModule);</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> AppComponent <span class="title function_">build</span><span class="params">()</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (appModule == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="built_in">this</span>.appModule = <span class="keyword">new</span> <span class="title class_">AppModule</span>();</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DaggerAppComponent</span>(appModule);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>大致流程和之前的容器代码一样</p>
<ul>
<li>1、被@Component 注释的接口 会自动以Dagger+接口名生成实现类,</li>
<li>2、重写接口方法，之前都是通过传入的需求方，进行赋值绑定，这次是通过一个带返回值的抽象方法方法，来获取实例。</li>
<li>3、接口方法，会通过AppModule 进行回去实例。</li>
</ul>
<p>分析:DaggerComputerComponent.class</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">DaggerComputerComponent</span> <span class="keyword">implements</span> <span class="title class_">ComputerComponent</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> PartsModule partsModule;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> AppComponent appComponent;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="title function_">DaggerComputerComponent</span><span class="params">(PartsModule partsModuleParam, AppComponent appComponentParam)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.partsModule = partsModuleParam;</span><br><span class="line">    <span class="built_in">this</span>.appComponent = appComponentParam;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> Builder <span class="title function_">builder</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Builder</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> MainBoard <span class="title function_">mainBoard</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> PartsModule_ProvideMainBoardFactory.provideMainBoard(partsModule, Preconditions.checkNotNullFromComponent(appComponent.provideElectric()));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">inject</span><span class="params">(Computer computer)</span> &#123;</span><br><span class="line">    injectComputer(computer);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> Computer <span class="title function_">injectComputer</span><span class="params">(Computer instance)</span> &#123;</span><br><span class="line">    Computer_MembersInjector.injectCpu(instance, PartsModule_ProvideCPUFactory.provideCPU(partsModule));</span><br><span class="line">    Computer_MembersInjector.injectCpu1(instance, PartsModule_ProvideCPUFactory.provideCPU(partsModule));</span><br><span class="line">    Computer_MembersInjector.injectElectric(instance, Preconditions.checkNotNullFromComponent(appComponent.provideElectric()));</span><br><span class="line">    Computer_MembersInjector.injectOtherPart(instance, <span class="keyword">new</span> <span class="title class_">OtherPart</span>());</span><br><span class="line">    Computer_MembersInjector.injectMainBoard(instance, mainBoard());</span><br><span class="line">    <span class="keyword">return</span> instance;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">Builder</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> PartsModule partsModule;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> AppComponent appComponent;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Builder</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Builder <span class="title function_">partsModule</span><span class="params">(PartsModule partsModule)</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.partsModule = Preconditions.checkNotNull(partsModule);</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Builder <span class="title function_">appComponent</span><span class="params">(AppComponent appComponent)</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.appComponent = Preconditions.checkNotNull(appComponent);</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> ComputerComponent <span class="title function_">build</span><span class="params">()</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (partsModule == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="built_in">this</span>.partsModule = <span class="keyword">new</span> <span class="title class_">PartsModule</span>();</span><br><span class="line">      &#125;</span><br><span class="line">      Preconditions.checkBuilderRequirement(appComponent, AppComponent.class);</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DaggerComputerComponent</span>(partsModule, appComponent);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>1、Builder 中新增 appComponent(),用于传入appComponent，</li>
<li>2、问题在于，injectMainBoard()时，构造参数由何而来，是通过appComponent.provideElectric()获取，这样就和上面的关联起来了。</li>
<li>3、如果在appComponent中 不提供实例，例如OtherPart(),那么injectOtherPart()则会帮忙new出一个实例，防止崩溃。</li>
</ul>
<h5 id="子组件范围-Subcomponent"><a href="#子组件范围-Subcomponent" class="headerlink" title="子组件范围@Subcomponent"></a>子组件范围@Subcomponent</h5><p>  日常开发时，登录流程（由单个 LoginActivity 管理）由多个 Fragment 组成，您应在所有 Fragment 中重复使用 LoginViewModel 的同一实例。@Singleton 无法为 LoginViewModel 添加注释以重复使用该实例，原因如下：</p>
<ul>
<li>流程结束后，LoginViewModel 的实例将继续保留在内存中。</li>
<li>您希望为每个登录流程使用不同的 LoginViewModel 实例。例如，如果用户退出，您希望使用不同的 LoginViewModel 实例，而不是用户首次登录时的实例。</li>
</ul>
<p>所以我们需要将loginViewModel的生命周期依赖于LoginActivity。</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>我们在开头的时候说了Dagger又高级，又低级，在真的搞明白了Dagger后，你会发现Dagger会让项目中实例的依赖更加清晰，减少很多重复工作，但一个简简单单的new()就可以解决的问题，却被搞得如此复杂，还是仁者见仁。</p>
<p>有些朋友接手Dagger或者Hilt项目后，甚至找不到对象由何而来，希望这篇文章可以帮助到你。</p>
<h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul>
<li><a target="_blank" rel="noopener" href="https://dagger.dev/">官网</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.android.google.cn/training/dependency-injection">androidGoogle官网</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.android.google.cn/training/dependency-injection#java">Android 中的依赖项注入</a></li>
</ul>

        </div>

        
            <section class="post-copyright">
                
                    <p class="copyright-item">
                        <span>Author:</span>
                        <span>Gx</span>
                    </p>
                
                
                
                

            </section>
        
        <section class="post-tags">
            <div>
                <span>Tag(s):</span>
                <span class="tag">
                    
                    
                        <a href="/tags/%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5/"># 依赖注入</a>
                    
                        <a href="/tags/Dagger2/"># Dagger2</a>
                    
                        
                </span>
            </div>
            <div>
                <a href="javascript:window.history.back();">back</a>
                <span>· </span>
                <a href="/">home</a>
            </div>
        </section>
        <section class="post-nav">
            
                <a class="prev" rel="prev" href="/2022/03/03/%E5%B7%A5%E5%8E%82%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">工厂设计模式</a>
            
            
            <a class="next" rel="next" href="/2022/03/02/LiveData/">LiveData</a>
            
        </section>


    </article>
</div>

            </div>
            <footer id="footer" class="footer">
    <div class="copyright">
        <span>© Gx | Powered by <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">Chic</a></span>
    </div>
</footer>

    </div>
</body>

</html>